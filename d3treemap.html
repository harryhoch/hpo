<!DOCTYPE html>
<head>
<style>

svg {
font: 10px sans-serif;
}

.node {
  box-sizing: border-box;
  line-height: 1em;
  overflow: hidden;
  position: absolute;
  white-space: pre;
  background: #ddd;
}

.node-label{
  margin: 4px;
  color:#222;
}

</style>

<script src="https://d3js.org/d3.v4.min.js"></script>

</head>

<body>

<svg width="960" height="570"></svg>


<script>

var svg = d3.select("svg"),
width = +svg.attr("width"),
height = +svg.attr("height");

var fader = function(color) { 
    return d3.interpolateRgb(color, "#fff")(0.2); 
};

var color = d3.scaleOrdinal(d3.schemeCategory20.map(fader));

// Creates a new treemap layout
var treemap = d3.treemap()
    .tile(d3.treemapResquarify) // This is the default with the golden ratio
    .size([width, height])
    .round(true)
    .paddingInner(1);

d3.json("treemap.json", function(error, data) {
    if (error) throw error;

// this is the treemap.json data
console.log(data);

    // Constructs a root node from the specified hierarchical data.
    var root = d3.hierarchy(data);

// The returned node and each descendant has the following properties: data, depth, height, parent, children, value
console.log(root);

    // https://github.com/d3/d3-hierarchy/#node_each
    root.each(function(d) { 
        if (d.depth > 0) {
          d.children = [];
          d.data.children = [];
        }
    });

console.log(root);

var newRoot = d3.hierarchy(root)
        .sum(sumByCount)
        .sort(function(a, b) { 
            // sort nodes by descending height (greatest distance from any descendant leaf) and then descending value
            return b.height - a.height || b.value - a.value; 
        });

    // Lays out the specified root hierarchy
    // You must call root.sum before passing the hierarchy to the treemap layout. 
    // You probably also want to call root.sort to order the hierarchy before computing the layout.
    // Also assigns the following properties on root and its descendants: x0, y0, x1, y1
    treemap(newRoot);

console.log(newRoot.leaves());

    var node = d3.select("body")
        .selectAll(".node")
        .data(newRoot.leaves())// Use the newroot to render
        .enter().append("div")
        .attr("id", function(d) { return d.data.data.id; })
        .attr("class", "node")
        .attr("title", function(d) { 
            return d.data.data.name + ' [' + d.data.data.id + ']'; 
        })
        .style("left", function(d) { return d.x0 + "px"; })
        .style("top", function(d) { return d.y0 + "px"; })
        .style("width", function(d) { return d.x1 - d.x0 + "px"; })
        .style("height", function(d) { return d.y1 - d.y0 + "px"; });

    // Text of each rectangle
    node.append("div")
        .attr("class", "node-label")
        .text(function(d) { 
            return d.data.data.name; 
        });

    // Show title toltip (full phenotype name and [id]) on mouse over. 
    node.append("title")
        .text(function(d) { return d.data.data.name + ' [' + d.data.data.id + ']'; });

});

function sumByCount(d) {
    return (d.children.length > 0) ? 0 : 1;
}

</script>

</body>

</html>