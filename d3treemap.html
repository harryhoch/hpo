<!DOCTYPE html>
<head>
<style>

form {
font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

svg {
font: 10px sans-serif;
}

</style>

<script src="https://d3js.org/d3.v4.min.js"></script>

</head>

<body>

<svg width="960" height="570"></svg>


<script>

var svg = d3.select("svg"),
width = +svg.attr("width"),
height = +svg.attr("height");

var fader = function(color) { 
    return d3.interpolateRgb(color, "#fff")(0.2); 
};

var color = d3.scaleOrdinal(d3.schemeCategory20.map(fader));

// Creates a new treemap layout
var treemap = d3.treemap()
    .tile(d3.treemapResquarify) // This is the default with the golden ratio
    .size([width, height])
    .round(true)
    .paddingInner(1);

d3.json("treemap.json", function(error, data) {
    if (error) throw error;

    // Constructs a root node from the specified hierarchical data.
    var root = d3.hierarchy(data)
        .sum(sumByCount)
        .sort(function(a, b) { 
            return b.height - a.height || b.value - a.value; 
        });

    treemap(root);

    var cell = svg.selectAll("g")
        .data(root.leaves())
        .enter().append("g")
        .attr("transform", function(d) { return "translate(" + d.x0 + "," + d.y0 + ")"; });

    cell.append("rect")
        .attr("id", function(d) { return d.data.id; })
        .attr("width", function(d) { return d.x1 - d.x0; })
        .attr("height", function(d) { return d.y1 - d.y0; })
        .attr("fill", function(d) { return color(d.parent.data.id); });

    // The <clipPath> SVG element defines a clipping path. A clipping path is used/referenced using the clip-path property.
    cell.append("clipPath")
        .attr("id", function(d) { return "clip-" + d.data.id; })
        .append("use")
        .attr("xlink:href", function(d) { return "#" + d.data.id; });
    
    // Text of each rectangle
    cell.append("text")
        .attr("clip-path", function(d) { 
            return "url(#clip-" + d.data.id + ")"; 
        })
        .text(function(d) { 
            return d.data.name; 
        });

    // Show title toltip (full phenotype name and [id]) on mouse over. 
    cell.append("title")
        .text(function(d) { return d.data.name + ' [' + d.data.id + ']'; });

});

function sumByCount(d) {
    return (d.children.length > 0) ? 0 : 1;
}

</script>

</body>

</html>